# Place all the behaviors and hooks related to the matching controller here.
# All this logic will automatically be available in application.js.
# You can use CoffeeScript in this file: http://coffeescript.org/

ready = ->
	
	# Grid layout for classified - index page
	
	$container = $('#classifieds')
	$container.imagesLoaded ->
  		$container.isotope itemSelector: ".item"
		
	# Endless scrolling
		
	if $('nav.pagination').length
		$container.infinitescroll
			navSelector: "nav.pagination"
			nextSelector: "nav.pagination a[rel=next]"
			itemSelector: ".item"
			finishedMsg: ''
			speed: 'fast'
			pixelsFromNavToBottom: -Math.round($(window).height() * 0.9)
			bufferPx: 1000
			(newElements) ->
				$newElems = $(newElements)
				$newElems.imagesLoaded ->
					$container.isotope "appended", $newElems
		
	# Classified multi-step form
			
	$('#classified-next-step').click (event) ->
		event.preventDefault()
		$('.classified-fields').toggle()
		$(event.target).toggle()
		$('.user-fields').toggle()
		$('#classified-submit').toggle()
			
	$('.fb-sign-up-classified').click (event) ->
		$.cookie 'classified_title', $('#classified_title').val(),
			domain: '<%= App.domain %>'
		$.cookie 'classified_category_id', $('#classified_category_id').val()
		$.cookie 'classified_description', $('#classified_description').val()
		$.cookie 'classified_image', $('#classified_image').val()
		$.cookie 'classified_price', $('#classified_price').val()

$(document).ready(ready)
$(document).on('page:load', ready)
